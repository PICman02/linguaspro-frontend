function getApiBase() {  return window.__API_URL__ || window.API_URL || "http://localhost:5001/api"; } document.addEventListener("DOMContentLoaded", () => {  const coursesContainer = document.getElementById("courses-container");  const coursesLoading = document.getElementById("courses-loading");  const coursesError = document.getElementById("courses-error");  const enrollModalEl = document.getElementById("enrollModal");  const enrollModal = new bootstrap.Modal(enrollModalEl);  const enrollForm = document.getElementById("enrollForm");  const modalCourseId = document.getElementById("modalCourseId");  const enrollCourseName = document.getElementById("enrollCourseName");  const enrollMsg = document.getElementById("enrollMsg");  const enrollBtn = document.getElementById("enrollBtn");  function showMsg(type, text) {   enrollMsg.className = `alert alert-${type}`;   enrollMsg.textContent = text;   enrollMsg.classList.remove("d-none");  }  function clearMsg() {   enrollMsg.classList.add("d-none");   enrollMsg.textContent = "";   enrollMsg.className = "alert d-none";  }  enrollModalEl.addEventListener("hidden.bs.modal", () => {   clearMsg();   enrollForm.reset();   modalCourseId.value = "";   enrollCourseName.textContent = "";   enrollBtn.disabled = false;   enrollBtn.textContent = "Confirmar Inscricao";  });  async function loadCourses() {   coursesLoading?.classList.remove("d-none");   coursesError?.classList.add("d-none");   try {    const res = await fetch(`${getApiBase()}/courses`);    if (!res.ok) throw new Error(`Erro API (${res.status})`);    const json = await res.json();    const courses = Array.isArray(json.courses) ? json.courses.filter((c) => Number(c.active) === 1) : [];    coursesLoading?.classList.add("d-none");    if (courses.length === 0) {     coursesContainer.innerHTML = "<p class='text-center my-4'>Nenhum curso disponivel</p>";     return;    }    coursesContainer.innerHTML = courses     .map(      (course) => `     <div class="col-md-4 mb-4">      <div class="course-card shadow-sm rounded bg-white p-4 h-100">       <h5 class="mb-2">${course.title || "Curso"}</h5>       <div class="d-flex gap-2 flex-wrap mb-2">        <span class="badge bg-secondary">${course.mode || ""}</span>        <span class="badge bg-success">${Number(course.price || 0).toLocaleString("pt-PT")} MZN</span>       </div>       <p class="text-muted">${course.description || ""}</p>       <button        type="button"        class="btn btn-primary mt-3 enroll-btn"        data-id="${course.id}"        data-title="${course.title || "Curso"}">        Inscrever-se       </button>      </div>     </div>    `     )     .join("");    bindEnrollButtons();   } catch (err) {    console.error("Falha ao carregar cursos:", err);    coursesLoading?.classList.add("d-none");    coursesError?.classList.remove("d-none");   }  }  function bindEnrollButtons() {   document.querySelectorAll(".enroll-btn").forEach((btn) => {    btn.addEventListener("click", () => {     modalCourseId.value = btn.dataset.id || "";     enrollCourseName.textContent = `Inscricao: ${btn.dataset.title || "Curso"}`;     clearMsg();     enrollModal.show();    });   });  }  enrollForm.addEventListener("submit", async (e) => {   e.preventDefault();   clearMsg();   const courseId = (modalCourseId.value || "").trim();   const studentName = (document.getElementById("studentName")?.value || "").trim();   const studentEmail = (document.getElementById("studentEmail")?.value || "").trim();   if (!courseId || !studentName || !studentEmail) {    showMsg("warning", "Preencha nome e email para concluir a inscricao.");    return;   }   enrollBtn.disabled = true;   enrollBtn.textContent = "A inscrever...";   try {    const res = await fetch(`${getApiBase()}/enrollments`, {     method: "POST",     headers: { "Content-Type": "application/json" },     body: JSON.stringify({      course_id: courseId,      student_name: studentName,      student_email: studentEmail,     }),    });    const json = await res.json().catch(() => ({}));    if (!res.ok) {     throw new Error(json.error || `Erro (${res.status}) ao inscrever`);    }    showMsg("success", "Inscricao realizada com sucesso.");    setTimeout(() => enrollModal.hide(), 900);   } catch (err) {    console.error("Erro ao inscrever:", err);    showMsg("danger", err.message || "Falha ao comunicar com o servidor");   } finally {    enrollBtn.disabled = false;    enrollBtn.textContent = "Confirmar Inscricao";   }  });  loadCourses(); }); 